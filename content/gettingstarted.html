<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2. Getting Started &mdash; TSMP_WorkflowStarter 1.1.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3. Directory Structure" href="directorystructure.html" />
    <link rel="prev" title="1. Introdction" href="introduction.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            TSMP_WorkflowStarter
          </a>
              <div class="version">
                1.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Content:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">1. Introdction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">2. Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#set-up-the-tsmp-workflowstarter">2.1. Set up the TSMP_WorkflowStarter</a></li>
<li class="toctree-l2"><a class="reference internal" href="#provide-restart-files">2.2. Provide restart files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#provide-forcing-boundary-files">2.3. Provide forcing (boundary) files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#start-a-simulation">2.4. Start a simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exercice">2.5. Exercice</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="directorystructure.html">3. Directory Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="substeps.html">4. Substeps</a></li>
<li class="toctree-l1"><a class="reference internal" href="jobsubmission.html">5. Job Submission</a></li>
<li class="toctree-l1"><a class="reference internal" href="auxiliaryscripts.html">6. Auxiliary Scripts</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">TSMP_WorkflowStarter</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><span class="section-number">2. </span>Getting Started</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/content/gettingstarted.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="getting-started">
<h1><span class="section-number">2. </span>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this heading"></a></h1>
<section id="set-up-the-tsmp-workflowstarter">
<h2><span class="section-number">2.1. </span>Set up the TSMP_WorkflowStarter<a class="headerlink" href="#set-up-the-tsmp-workflowstarter" title="Permalink to this heading"></a></h2>
<p><strong>First</strong>, clone this repository into your project-directory with its
dependencies marked with Git submodules,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$PROJECT_DIR</span>
git<span class="w"> </span>clone<span class="w"> </span>--recurse-submodules<span class="w"> </span>https://github.com/niklaswr/TSMP_WorkflowStarter.git
</pre></div>
</div>
<p>and export the following path to an environment variable for later use.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$PROJECT_DIR</span>/TSMP_WorkflowStarter
<span class="nb">export</span><span class="w"> </span><span class="nv">BASE_ROOT</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>
</pre></div>
</div>
<p><strong>Second</strong>, get TSMP ready by cloning all component models (COSMO, ParFlow,
CLM, and Oasis) into <code class="docutils literal notranslate"><span class="pre">src/TSMP/</span></code>,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">BASE_ROOT</span><span class="si">}</span>/src/TSMP
<span class="nb">export</span><span class="w"> </span><span class="nv">TSMP_DIR</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>
git<span class="w"> </span>clone<span class="w"> </span>https://icg4geo.icg.kfa-juelich.de/ModelSystems/tsmp_src/cosmo5.01_fresh.git<span class="w">  </span>cosmo5_1
git<span class="w"> </span>clone<span class="w"> </span>-b<span class="w"> </span>v3.12.0<span class="w"> </span>https://github.com/parflow/parflow.git<span class="w">                             </span>parflow
git<span class="w"> </span>clone<span class="w"> </span>https://icg4geo.icg.kfa-juelich.de/ModelSystems/tsmp_src/clm3.5_fresh.git<span class="w">     </span>clm3_5
git<span class="w"> </span>clone<span class="w"> </span>https://icg4geo.icg.kfa-juelich.de/ModelSystems/tsmp_src/oasis3-mct.git<span class="w">       </span>oasis3-mct
</pre></div>
</div>
<p>and build the binaries.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$TSMP_DIR</span>/bldsva
git<span class="w"> </span>apply<span class="w"> </span><span class="si">${</span><span class="nv">BASE_ROOT</span><span class="si">}</span>/ctrl/externals/TSMP_Patch/ClmSendZero.patch
./build_tsmp.ksh<span class="w"> </span>--readclm<span class="o">=</span><span class="nb">true</span><span class="w"> </span>-v<span class="w"> </span><span class="m">3</span>.1.0MCT<span class="w"> </span>-c<span class="w"> </span>clm-cos-pfl<span class="w"> </span>-m<span class="w"> </span>JURECA<span class="w"> </span>-O<span class="w"> </span>Intel
</pre></div>
</div>
<p><strong>Finally</strong>, adapt <code class="docutils literal notranslate"><span class="pre">ctrl/export_paths.sh</span></code> to correctly determine the root
directory of this workflow:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$BASE_ROOT</span>/ctrl
vi<span class="w"> </span>export_paths.sh
</pre></div>
</div>
<p>Within this file change the line<br />
<code class="docutils literal notranslate"><span class="pre">rootdir=&quot;/p/scratch/cesmtst/wagner6/${expid}&quot;</span></code><br />
according to you <code class="docutils literal notranslate"><span class="pre">$PROJECT_DIR</span></code> from above. To verify <code class="docutils literal notranslate"><span class="pre">rootdir</span></code> is set properly
do<br />
<code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">$BASE_ROOT/ctrl/export_paths.sh</span> <span class="pre">&amp;&amp;</span> <span class="pre">echo</span> <span class="pre">&quot;$rootdir&quot;</span> <span class="pre">&amp;&amp;</span> <span class="pre">ls</span> <span class="pre">-l</span> <span class="pre">$rootdir</span></code>.<br />
You should see the following content:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PATH</span><span class="o">/</span><span class="n">TO</span><span class="o">/</span><span class="n">YOUR</span><span class="o">/</span><span class="n">PROJECT</span>
<span class="n">ctrl</span><span class="o">/</span>
<span class="n">doc</span><span class="o">/</span>
<span class="n">forcing</span><span class="o">/</span>
<span class="n">geo</span><span class="o">/</span>
<span class="n">LICENSE</span>
<span class="n">monitoring</span><span class="o">/</span>
<span class="n">postpro</span><span class="o">/</span>
<span class="n">README</span><span class="o">.</span><span class="n">md</span>
<span class="n">rundir</span><span class="o">/</span>
<span class="n">simres</span><span class="o">/</span>
<span class="n">src</span><span class="o">/</span>
</pre></div>
</div>
<p>The setup is now complete, and can be run after providing proper restart and
forcing files.</p>
</section>
<section id="provide-restart-files">
<h2><span class="section-number">2.2. </span>Provide restart files<a class="headerlink" href="#provide-restart-files" title="Permalink to this heading"></a></h2>
<p>To continue a simulation, restart-files are needed to define the initial
state of the simulation. Since large simulations (simulation period of years /
several decades), such as we are aiming for, are usually calculated as a
sequence of shorter simulations (simulation period of days / months), each
simulation represents a restart of the previous simulation. Therefore, restart
files must be provided for each component and simulation.</p>
<p>Within this workflow, the component models expect the individual restart files
to be located at:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$BASE_ROOT</span>/rundir/MainRun/restarts/COMPONENT_MODEL
</pre></div>
</div>
<p>During the normal course of this workflow, the restart files are automatically
placed there. Only for the very first simulation the user has to provide
restart files manually to initialise the simulation. Therefore it is important
to know that COSMO is able to run without restart files, than running a
cold-start, while CLM and ParFlow always expect restart-files. So the user
only needs to provide restart-files for ParFlow and CLM only.</p>
<p>In this example, we do run a simulation over the EUR-11 domain for the year
1970, for which restart files could be taken from:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">p</span><span class="o">/</span><span class="n">project</span><span class="o">/</span><span class="n">cslts</span><span class="o">/</span><span class="n">wagner6</span><span class="o">/</span><span class="n">TempForcAndRestFileFor_TSMP_WorkflowStarter</span><span class="o">/</span><span class="n">restarts</span>
</pre></div>
</div>
<p>If needed, do request access to the related data project via <a class="reference external" href="https://judoor.fz-juelich.de/login">JuDoor</a>.</p>
<p>To make the restart files available, go to the restart directory, and copy the
restart files there:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$BASE_ROOT</span>/rundir/MainRun/restarts
<span class="c1"># copy CLM restart file</span>
cp<span class="w"> </span>-r<span class="w"> </span>/p/project/cslts/wagner6/TempForcAndRestFileFor_TSMP_WorkflowStarter/restarts/clm<span class="w"> </span>./
<span class="c1"># copy ParFlow restart file</span>
cp<span class="w"> </span>-r<span class="w"> </span>/p/project/cslts/wagner6/TempForcAndRestFileFor_TSMP_WorkflowStarter/restarts/parflow<span class="w"> </span>./
</pre></div>
</div>
<p><strong>NOTE</strong>:
ParFlow needs the previous model-outpt as a restart-file, whereas CLM needs a
special restart-file from the current time-step. This is why the date within
the file name is different.</p>
</section>
<section id="provide-forcing-boundary-files">
<h2><span class="section-number">2.3. </span>Provide forcing (boundary) files<a class="headerlink" href="#provide-forcing-boundary-files" title="Permalink to this heading"></a></h2>
<p>COSMO is a local model, simulating only a subdomain of the globe, and therefore
needs to be informed about incoming meteorological conditions passing the
boundary (as e.g. low pressure systems). This is done using local boundary
files (lbf for short). At the same time, the status quo of the atmosphere is
needed for the first time step (not to be confused with restart files!). In
the meteorological domain this status quo is called ‘analysis’, wherefore this
information is passed to COSMO with so called ‘local analysis files’  (laf for
short).</p>
<p>These two types of boundary files must to be provided for each simulation and
are expected by the workflow under:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$BASE_ROOT</span>/forcing/laf_lbfd/all
</pre></div>
</div>
<p>In this example, we do run a simulation over the EUR-11 domain for the year
1970, for which forcing files could be taken from:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">p</span><span class="o">/</span><span class="n">project</span><span class="o">/</span><span class="n">cslts</span><span class="o">/</span><span class="n">wagner6</span><span class="o">/</span><span class="n">TempForcAndRestFileFor_TSMP_WorkflowStarter</span><span class="o">/</span><span class="n">forcing</span><span class="o">/</span><span class="n">laf_lbfd</span><span class="o">/</span><span class="mi">1970</span>
</pre></div>
</div>
<p>If needed, do request access to the data project via <a class="reference external" href="https://judoor.fz-juelich.de/login">JuDoor</a>.</p>
<p>To properly provide these files, do copy the directory from above to your
workflow and link all files to <code class="docutils literal notranslate"><span class="pre">$BASE_ROOT/forcing/laf_lbfd/all</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># move to forcing dir and copy forcing files</span>
<span class="nb">cd</span><span class="w"> </span><span class="nv">$BASE_ROOT</span>/forcing/laf_lbfd/
cp<span class="w"> </span>-rv<span class="w"> </span>/p/project/cslts/wagner6/TempForcAndRestFileFor_TSMP_WorkflowStarter/forcing/laf_lbfd/1970<span class="w"> </span>./
<span class="c1"># link boundary files to all/</span>
<span class="nb">cd</span><span class="w"> </span><span class="nv">$BASE_ROOT</span>/forcing/laf_lbfd/
mkdir<span class="w"> </span>all
<span class="nb">cd</span><span class="w"> </span>all
ln<span class="w"> </span>-sf<span class="w"> </span>../1970/l*<span class="w"> </span>./
</pre></div>
</div>
</section>
<section id="start-a-simulation">
<h2><span class="section-number">2.4. </span>Start a simulation<a class="headerlink" href="#start-a-simulation" title="Permalink to this heading"></a></h2>
<p>To start a simulation simply execute <code class="docutils literal notranslate"><span class="pre">starter.sh</span></code> from <code class="docutils literal notranslate"><span class="pre">ctrl</span></code> directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$BASE_ROOT</span>/ctrl
<span class="c1"># adjust according to you need between </span>
<span class="c1"># &#39;Adjust according to your need BELOW&#39;</span>
<span class="c1"># and</span>
<span class="c1"># &#39;Adjust according to your need ABOVE&#39;</span>
vi<span class="w"> </span>./starter.sh<span class="w"> </span>
<span class="c1"># start the simulation</span>
./starter.sh<span class="w"> </span>
</pre></div>
</div>
</section>
<section id="exercice">
<h2><span class="section-number">2.5. </span>Exercice<a class="headerlink" href="#exercice" title="Permalink to this heading"></a></h2>
<p>To become a little bit famillar with this workflow, work on the following tasks:</p>
<ol class="arabic simple">
<li><p>Do simulate the compleat year of 2020.</p></li>
<li><p>Plot a time serie of the spatial averaged 2m temperature for 2020.</p></li>
<li><p>Write down which information / data / files you might think are needed to
repoduce the simulation.</p></li>
<li><p>Think about how you could check the simulation is running fine during
runtime.</p></li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="introduction.html" class="btn btn-neutral float-left" title="1. Introdction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="directorystructure.html" class="btn btn-neutral float-right" title="3. Directory Structure" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Niklas WAGNER.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>